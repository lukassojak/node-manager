# Zone Configuration Wizard – Detailed Step Description

This chapter describes the **page / wizard for creating a new irrigation zone** in the Node Manager application.  
The wizard is a **key UX element** of the entire application and also the place where the biggest difference between **PHASE 1 (MVP)** and **PHASE 2 (extended logic)** occurs.

The goals of the wizard are:
- guide the user step by step,
- minimize configuration errors,
- produce a **clear and valid zone configuration** at the end.

---

## Wizard Overview

The wizard is divided into **logical steps** aligned with the SIS domain model:

1. Basic zone information  
2. Irrigation mode selection  
3. Irrigation configuration (mode-dependent)  
4. Emitters configuration (phase-dependent)  
5. Summary and zone creation  

Not all steps are mandatory for all modes or phases.

---

# PHASE 1 – MVP (current target implementation)

In Phase 1, the primary goals are **simplicity, transparency, and backend compatibility**.  
The user provides **final configuration data**, while the backend only validates, stores, and exports it.

---

## Step 1: Basic Zone Information

**Goal:** Identify the zone and define its physical connection.

### Inputs:
- Zone name (string)
- Relay pin / output (int)
- `enabled` toggle (bool)

### Notes:
- The name is informational only (UI + export).
- The relay pin must match the node’s hardware configuration.
- The zone ID is generated by the backend.
- `enabled=false` allows the zone to exist in configuration but be skipped at runtime.

---

## Step 2: Irrigation Mode Selection

**Goal:** Decide how the zone will be irrigated.

### Options:
- `even_area` – uniform irrigation of an area with known size
- `per_plant` – irrigation based on individual plant needs (e.g. pots with different plants)

The selected mode **determines the next wizard steps**.

---

## Step 3A: Configuration – `even_area` Mode

**Goal:** Define the irrigated area and the target water dose.

### Inputs:
- `zone_area_m2` (float) – irrigated area in square meters
- `target_mm` (float) – target water depth in millimeters for base conditions (weather);  
  the SIS node applies weather-based corrections at runtime

### Result:
- UI stores `IrrigationConfigurationEvenArea`
- Backend only persists the data
- SIS computes the base water volume at runtime

---

## Step 3B: Configuration – `per_plant` Mode (MVP)

**Goal:** Define the final water volume for the entire zone.

### Inputs:
- `base_target_volume_liters` (float) – target water volume in liters for the whole zone under base weather conditions

### Notes:
- The user:
  - calculates the value manually, or
  - estimates it
- Plant details entered in the next step are **not used for calculations** in Phase 1

---

## Step 4: Emitters Configuration (MVP)

**Goal:** Enter the **final emitters configuration** that SIS will use directly.

### `even_area`:
- list of emitter types
- flow rate
- quantity
- “Add emitter” button:
  - adds a new row with type, flow rate, and count

### `per_plant`:
- list of plants
- for each plant:
  - emitter type
  - flow rate
  - quantity
- “Add plant” button:
  - adds a new row with plant ID, name, and option to add emitters
- “Add emitter” button per plant:
  - adds a new row with type, flow rate, and count

> Note: In this phase, the UI **does not perform any calculations**.  
> The user enters the **exact configuration** to be used.  
> IDs in Phase 1 are not validated or generated by the backend — they are entered manually by the user.

### Result:
- UI creates:
  - `EmittersConfigurationEvenArea`, or
  - `EmittersConfigurationPerPlant`
- Backend only stores the configuration

---

## Step 5: Summary and Zone Creation

**Goal:** Final validation before saving.

### Displayed:
- zone name
- irrigation mode
- target water amount
- emitters overview

### Actions:
- “Create zone”
- POST `/nodes/{id}/zones`

---

# PHASE 2 – Extended Wizard (planned)

In Phase 2, the wizard becomes a **design tool**, not just a form.

The user:
- specifies goals and constraints,
- the backend performs calculations and optimization.

---

## Steps 1 & 2

Unchanged:
- basic zone information
- irrigation mode selection

---

## Step 3: Plants (`per_plant` – extended)

**Goal:** Describe the needs of individual plants.

### Inputs:
- list of plants:
  - name
  - required water volume in liters (base conditions)
- option to:
  - “lock” a plant (its amount must not change during optimization; see step 5)

### Output:
- design-time data (summary only for the user)

---

## Step 4: Available Emitters

**Goal:** Define physical system constraints.

### Inputs:
- list of available emitter types:
  - flow rate (l/h)
  - available quantity / unlimited

---

## Step 5: Optimization Strategy

**Goal:** Influence the behavior of the optimization algorithm.

### Options:
- `most_accuracy`
  - maximum water delivery accuracy
  - more emitters used
- `optimize_drippers_count`
  - fewer emitters
  - tolerated deviation (optionally user-defined)
- per-plant lock:
  - selected plants remain exact (from step 3)

---

## Step 6: Optimization Result

**Goal:** Transparently show what the backend computed.

### Displayed:
- resulting emitters configuration
- actual delivered water volume per plant
- deviations from requested values

The user can:
- accept the result
- go back and adjust inputs

---

## Step 7: Summary and Zone Creation

The backend:
- computes from design-time data:
  - `EmittersConfigurationPerPlant`
  - `IrrigationConfigurationPerPlant`
- stores **only runtime configuration**
- export format remains unchanged

---

## Phase 1 vs Phase 2 Comparison

| Area | PHASE 1 (MVP) | PHASE 2 |
|----|---------------|---------|
| UI | Form | Design wizard |
| Calculations | None | Backend |
| User provides | Final config | Goals + constraints |
| Backend | Stores | Optimizes |
| SIS | Runtime execution | Runtime execution |

---

## Key Architectural Advantage

Despite the significant wizard expansion:
- **the export format does not change**
- **the SIS API does not change**

Only the following change:
- data source
- calculation method
- optionally backend DB schema (zone plants JSON → table), API
